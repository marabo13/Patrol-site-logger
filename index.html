<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Start Patrol</title>
  <style>
    body{
      font-family:system-ui;
      background:#0b0214;
      color:#f7f2ff;
      padding:40px;
    }
    .card{
      max-width:460px;
      margin:auto;
      padding:18px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.15);
      background:rgba(255,255,255,.05);
    }
    h2{margin:0 0 8px}
    .small{color:#cdb7ff;font-size:13px;margin:0 0 12px}
    button{
      width:100%;
      padding:14px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.2);
      background:#3a1b6d;
      color:#fff;
      font-weight:900;
      cursor:pointer;
      font-size:15px;
    }
    button:disabled{opacity:.6;cursor:not-allowed}
    #status{margin-top:12px;color:#cdb7ff;font-size:13px}
  </style>
</head>

<body>
  <div class="card">
    <h2>Patrol Logger</h2>
    <p class="small">Click the button to start your patrol log in Discord.</p>

    <button id="startBtn">Start Patrol</button>
    <div id="status"></div>
  </div>

<script>
const btn = document.getElementById("startBtn");
const status = document.getElementById("status");

btn.addEventListener("click", async () => {
  btn.disabled = true;
  status.textContent = "Sending...";

  try{
    const res = await fetch("/.netlify/functions/patrol", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({
        action: "Start Patrol",
        time: new Date().toISOString()
      })
    });

    const text = await res.text();
    let data = {};
    try{ data = JSON.parse(text); }catch{}

    if(!res.ok) throw new Error(data.error || text || `HTTP ${res.status}`);

    status.textContent = "✅ Patrol started (logged to Discord)!";
  }catch(e){
    status.textContent = "❌ " + e.message;
  }finally{
    btn.disabled = false;
  }
});
</script>
</body>
</html>
